<head>
  <title>AKQA's Massage Booking System</title>
  <!-- TODO: Style sheet for print to hide admin panel -->
</head>

<body>
  {{#if isAdmin}}
    {{> allSessions}}
  {{/if}}
  <br>
  {{> massageTable}}
</body>

<template name="allSessions">
  <div class="admin-container days-container pull-right">
    <h5>Admin Only</h5>
    <div>
      <div>
        Please choose a day to edit:
        <select id="day-select" class="pull-right">
          {{#each days}}
            <option {{selected}} value="{{_id}}">{{formatTimestamp dayTimestamp}}</option>
          {{/each}}
        </select>
        <div style="text-align:center;margin:10px;">- or -</div>
      </div>
    </div>
    <div>
      <input type="text" placeholder="Click to choose a day to add" id="new-day-date">
      <button class="add-day">Add new day</button>
    </div>
    <!-- TODO: Print this list -->
  </div>
</template>

<template name="masseuseHeader">
  <th data-masseuse="{{masseuse}}">
    <div class="masseuse-name-readonly">
      <span id="masseuse1-name">
      {{#if masseuseName masseuse}}
        Therapist: {{masseuseName masseuse}}
      {{else}}
        Therapist #{{masseuse}}
      {{/if}}
      </span>
      {{#if isAdmin}}
        <!-- <button class="change-masseuse-name btn-link">change</button> -->
        <a href="#" class="change-masseuse-name pull-right">change</a>
      {{/if}}
    </div>
    <div class="masseuse-name-editing">
      <input placeholder="Therapist #{{masseuse}}" type="text" class="masseuse-name" value="{{masseuseName masseuse}}" />
      <!-- <button class="save-masseuse-name btn-link">save</button> -->
      <a href="#" class="save-masseuse-name pull-right">save</a>
    </div>
  </th>
</template>

<template name="massageTable">
  <h1>Massage Booking System</h1>
  {{#unless loaded}}
    Loading. Please wait...
  {{else}}
    <h3>Massages for {{date}}</h3>
    {{#if isAdmin}}
      <div>
        {{#if currentDayIsActive}}
          This list is visible to the public.
        {{else}}
          This list is not visible to the public.
          <button class="btn btn-primary toggle-active">Make this list visible</button>
        {{/if}}
      </div>
    {{/if}}
    <table class="table table-striped table-bordered" id="massageTable">
      <thead>
        <th>Time Slot</th>
        {{partial "masseuseHeader" masseuse="1"}}
        {{partial "masseuseHeader" masseuse="2"}}
      </thead>
      {{#each slots}}
      <tr>
        <td>{{displayTime}}</td>
        <td>
          {{#if masseuse1.available}}
            <div>
              {{#if masseuse1.customerName}}
                {{masseuse1.customerName}}
                {{#if isAdmin}}
                  <a title="Remove this booking" data-masseuse="1" href="#" class="btn-link remove-booking pull-right">x</a>
                {{/if}}
              {{else}}
                <input class="time-slot-input" id="1-input-{{_id}}" type="text" placeholder="Available slot">
                <button data-slotId="{{_id}}" data-masseuse="1" class="book-time-slot">Book</button>
              {{/if}}
            </div>
            {{#if isAdmin}}
              <div><a data-masseuse="1" href="#" class="btn-link make-unavailable">Make unavailable</a></div>
            {{/if}}
          {{else}}
            <div>This slot is unavailable</div>
            {{#if isAdmin}}
              <div>
                {{#if masseuse1.customerName}}
                  (Previously booked by {{masseuse1.customerName}})
                {{/if}}
              </div>
              <div><a data-masseuse="1" href="#" class="btn-link make-available">Make available</a></div>
            {{/if}}
          {{/if}}
        </td>
        <td>
          {{#if masseuse2.available}}
            <div>
              {{#if masseuse2.customerName}}
                {{masseuse2.customerName}}
                {{#if isAdmin}}
                  <a title="Remove this booking" data-masseuse="2" href="#" class="btn-link remove-booking pull-right">x</a>
                {{/if}}
              {{else}}
                <input class="time-slot-input" id="2-input-{{_id}}" type="text" placeholder="Available slot">
                <button data-slotId="{{_id}}" data-masseuse="2" class="book-time-slot">Book</button>
              {{/if}}
            </div>
            {{#if isAdmin}}
              <div><a data-masseuse="2" href="#" class="btn-link make-unavailable">Make unavailable</a></div>
            {{/if}}
          {{else}}
            <div>This slot is unavailable</div>
            {{#if isAdmin}}
              <div>
                {{#if masseuse2.customerName}}
                  (Previously booked by {{masseuse2.customerName}})
                {{/if}}
              </div>
              <!-- admin only -->
              <div><a data-masseuse="2" href="#" class="btn-link make-available">Make available</a></div>
            {{/if}}
          {{/if}}
        </td>
      </tr>
      {{/each}}
    </table>
  {{/unless}}
</template>
